#!/bin/bash
#SBATCH -N 1 #Number of nodes
#SBATCH -n 8 # number of cores
#SBATCH --mem 40G # memory pool for all cores
#SBATCH -t 0-01:00 # time (D-HH:MM)
#SBATCH -o cutesv_{0}.%N.%j.log
#SBATCH -e cutesv_{0}.%N.%j.log
#SBATCH --mail-type=FAIL
#SBATCH --account=rrg-tetreaum
#SBATCH --mail-user={1}

ml apptainer/1.4.5

CUTESV_IMAGE="apptainer run /lustre09/project/6019267/shared/tools/variants/SVs/cutesv/cutesv.sif"
WORKDIR="/lustre10/scratch/$USER/{2}/results/cutesv/{0}"

mkdir -p $WORKDIR
mkdir -p $WORKDIR/tmp

$CUTESV_IMAGE cuteSV \
        {3} \
        {4} \
        $WORKDIR/{0}_cutesv.vcf \
        $WORKDIR/tmp \
        --max_size 1000000 \
        --min_support 3 \
        --genotype \
        --max_cluster_bias_INS 100 \
        --diff_ratio_merging_INS 0.3 \
        --max_cluster_bias_DEL 100 \
        --diff_ratio_merging_DEL 0.3 \
        --threads $SLURM_CPUS_PER_TASK


if [ $? -eq 0 ]; then
    echo "cutesv_{0}" >> "$STEPS_DONE"
fi